1. OAuth
    1. OAuth는 제 3의 서비스에 계정 관리를 맡기는 방식입니다. 네이버로 로그인하기,구글로 로그인하기 같은 방법입니다.
    2. OAuth 관련 용어 정리
        1. 리소스 오너 : 인증 서버에 자신의 정보를 사용하도록 허가하는 주체입니다. 서비스를 이용하는 사용자가 리소스 오너에 해당됩니다.
        2. 리소스 서버 : 리소스 오너의 정보를 가지며, 리소스 오너의 정보를 보호하는 주체를 의미합니다. 네이버,구글,페이스북이 리소스 서버에 해당합니다.
        3. 인증 서버 : 클라이언트에게 리소스 오너의 정보에 접근할 수 있는 토큰을 발급하는 역할을 하는 애플리케이션을 의미합니다.
        4. 클라이언트 애플리케이션 : 인증 서버에게 인증을 받고 리소스 오너의 리소스를 사용하는 주체를 의미합니다. 지금 만들고 있는 서비스가 이에 해당됩니다.
    3. 클라이언트가 리소스 오너 정보를 취득할 수 있는 방법 4가지
        1. **권한 부여 코드 승인 타입** : OAuth 2.0에서 가장 잘 알려진 인증 방법입니다. 클라이언트가 리소스에 접근하는 데 사용하며, 권한에 접근할 수 있는 코드와 리소스 오너에 대한 액세스 토큰을 발급받는 방식입니다.(이 방법은 서비스에서 가장 중요한 정보인 사용자 데이터가 외부로 전송되지 않아 안전하고 OAuth에서 가장 잘 알려진 인증 방법이기도 합니다.)
        2. **암시적 승인 타입** : 서버가 없는 자바스크립트 웹 애플리케이션 클라이언트에서 주로 사용하는 방법입니다. 클라이언트가 요청을 보내면 리소스 오너의 인증 과정 이외에는 권한 코드 교환 등의 별다른 인증 과정을 거치지 않고 액세스 토큰을 제공받는 방식입니다.
        3. **리소스 소유자 암호 자격증명 승인 타입** : 클라이언트의 패스워드를 이용해서 액세스 토큰에 대한 사용자의 자격 증명을 교환하는 방식입니다.
        4. **클라이언트 자격증명 승인 타입** : 클라이언트가 컨텍스트 외부에서 액세스 토큰을 얻어 특정 리소스에 접근을 요청할 때 사용하는 방식입니다.
2. 권한 부여 코드 승인 타입
    1. 이 방식을 이해하기 위해서는 애플리케이션, 리소스 오너(사용자),리소스 서버, 인증 서버가 어떤 순서가 인증을 하는지 알아야합니다.
        1. 리소스 오너 → 애플리케이션 : 권한 요청
        2. 리소스 서버 → 리소스 오너 : 데이터 접근용 권한 여부
        3. 애플리케이션 → 인증서버 : 인증코드 발급 & 액세스 토큰으로 발급
        4. 애플리케이션 →리소스서버 : 액세스 토큰으로 데이터에 접근

        * 리소스 서버 → 인증 서버 : 인증 서버에 인증 작업 위임
    2. 권한 요청은 클라이언트 즉, 스프링 부트 서버가 특정 사용자 데이터에 접근하기 위해 권한 서버 카카오나 구글 권한 서버에 요청을 보내느 겁니다. 요청 URI는 권한 서버마다 다르지만 보통은 클라이언트 ID,리다이렉트 URI,응답 타입 등을 파라미터로 보냅니다.
        1. 실제 요청에 쓰이는 요청 URI를 통해 주요 파라미터

            ```java
            GET spring-authorization-server.example/authorize?
            	client_id =66a36b4c2&
            	redirect_uri = http://localhost:8080/myapp&
            	response_type = code&
            	scope = profile
            ```

        2. client_id : 인증 서버가 클라이언트에 할당한 고유 식별자입니다. 이 값은 클라이언트 애플리케이션을 OAuth 서비스에 등록할 때 서비스에서 생성하는 값입니다.
        3. redirect_uri : 로그인 성공 시 이동해야 하는 URI입니다.
        4. response_type : 클라이언트가 제공받길 원하는 응답 타입입니다. 인증 코드를 받을 때는 code값을 포함해야 합니다.
        5. scope : 제공받고자 하는 리소스 오너의 정보 목록입니다.
    3. 데이터 접근용 권한 부여
        1. 인증 서버에 요청을 처음 보내는 경우 사용자에게 보이는 페이지를 로그인 페이지로 변경하고 사용자의 데이터에 접근 동의를 얻습니다.이 과정은 최초 1회만 진행됩니다. 이후에는 인증 서버에서 동의 내용을 저장하고 있기 때문에 로그인만 진행합니다. 로그인이 성공되면 권한 부여 서버는 데이터에 접근할 수 있게 인증 및 권한 부여를 수신합니다.
        2. 사용자가 로그인에 성공하면 권한 요청 시에 파라미터에 인증코드를 함께 제공합니다.
    4. 액세스 토큰 응답
        1. /token POST 요청 예

            ```java
            POST spring-authorizaiont-server-example.com/token
            {
            	"client_id" : "66a36b4c2",
            	"client_secret" : "aabb11dd44",
            	"redirect_uri" : "http://localhost:8080/myapp",
            	"grant-type" : "authorization_code",
            	"code" : "a1b2c3d4e5f6g7h8"
            }
            ```

        2. client_secret
            1. OAuth 서비스에 등록할 때 제공받는 비밀키입니다.
        3. grant_type
            1. 권한 유형을 확인하는 데 사용합니다. 권한 서버는 요청 값을 기반으로 유효한 정보인지 확인하고, 유효한 정보라면 액세스 토큰으로 응답합니다.
3. 쿠키
    1. 쿠키란 사용자가 어떠한 웹사이트를 방문했을 때  해당 웹사이트의 서버에서 로컬 환경에 저장하는 작은 데이터를 말합니다. 이 값이 있기 때문에 이전에 방문한 적이 있는지 알 수 있고, 이전에 로그인을 했다면 로그인 정보도 유지할 수 있는 것입니다. 쿠키는 키와 값으로 이루어져 있으며 만료기간,도메인 등의 정보를 가지고 있습니다.
    2. 클라이언트가 정보를 요청하면 서버에서 정보를 값으로 넣은 쿠키를 생성해서 요청한 정보를 HTTP 헤더와 함께 돌려보냅니다. 클라이언트는 브라우저에 쿠키를 저장합니다. 이후 사이트에 재방문할 때는 사용자가 로컬 환경에 있는 쿠키와 함께 서버에 요청합니다.
    3.쿠키를 실제로 삭제하는 방법은 없으므로 파라미터로 넘어온 키의 쿠키를 빈 값으로 바꾸고 만료 시간을 0으로 설정해 쿠키가 재생성 되자마자 만료 처리합니다.

4. GitHub에 application.yml 파일의 특정 부분을 업로드하지 않으려면, 민감한 정보를 보호하기 위해 .gitignore 파일을 사용하거나, git update-index --assume-unchanged 명령어로 특정 파일의 변경 사항을 추적하지 않도록 할 수 있습니다. 각각의 방법을 설명하겠습니다.

    1. .gitignore 파일 사용하기

    application.yml 파일 자체를 GitHub에 올리지 않으려면, .gitignore 파일에 추가하는 방법이 있습니다.

        1.	프로젝트 루트 폴더에 .gitignore 파일을 열거나 새로 만듭니다.
        2.	다음과 같이 .gitignore 파일에 application.yml을 추가합니다.

    # application.yml 파일을 GitHub에 업로드하지 않음
    src/main/resources/application.yml



        이 방법은 application.yml 전체 파일이 커밋되지 않게 합니다. 만약 일부 설정만 제외하고 싶다면, 다음 방법을 참고하세요.

    2. git update-index --assume-unchanged 사용

    파일의 특정 부분만 추적하지 않는 것은 어렵지만, 파일 전체에 대한 변경 사항을 추적하지 않도록 설정할 수 있습니다. 이 경우 application.yml 파일을 로컬에서 수정해도 Git이 해당 변경 사항을 무시하도록 할 수 있습니다.

        1.	터미널을 열고 아래 명령어를 실행합니다.

    git update-index --assume-unchanged src/main/resources/application.yml


        2.	이 명령어를 사용하면 application.yml 파일이 변경되더라도 Git은 해당 파일을 무시합니다. 다시 추적하고 싶다면 아래 명령어를 사용하면 됩니다.

    git update-index --no-assume-unchanged src/main/resources/application.yml



    이 방법들은 민감한 정보를 보호하면서도 다른 코드나 설정은 정상적으로 GitHub에 업로드할 수 있게 해줍니다.

5. OAuth2와 JWT를 함께 사용하려면 기존 스프링 시큐리티를 구현한 설정이 아니라 다른 설정을 사용해야 합니다.

6. OAuth2 설정 파일 → (WebOAuthSecurityConfig 파일 참고)
    1. filterChain()메서드
        1. 토큰방식으로 인증을 하므로 기존 폼 로그인, 세션 기능을 비활성화 합니다.
    2. addFilterBefore()헤더값 확인용 커스텀 필터 추가
        1. 헤더값을 확인할 커스텀 필터를 추가합니다.
    3. authorizeRequests()메서드 URL 인증 설정
        1. 토큰 재발급 URL은 인증없이 접근하도록 설정하고 나머지 API들은 인증을 해야 접근하도록 설정합니다
    4. oauth2Login() 메서드 이후 체인 메서드 수정
        1. OAuth2에 필요한 정보를 세션이 아닌 쿠키에 저장해서 쓸 수 있또록 인증 요청과 관련된 상태를 저장할 저장소를 설정합니다. 인증 성공 시 실행할 핸들러도 설정합니다.
    5. exceptionHandling()메서드 예외 처리 설정
        1. /api로 시작하는 url인 경우 인증 실패 시 401 상태 코드 즉 Unauthorized를 반환합니다.